package de.george.lrentnode.structures;

import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_13;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_14;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_15;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_16;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_17;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_18;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_19;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_20;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_21;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_22;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_23;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_24;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_25;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_26;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_27;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_28;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_29;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_30;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_31;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_32;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_33;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_34;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_35;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_36;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_37;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_38;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_39;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_40;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_41;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_42;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_43;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_44;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_45;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_46;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_47;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_48;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_49;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_50;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_51;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_52;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_53;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_54;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_55;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_56;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_57;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_58;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_59;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_60;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_61;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_62;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_63;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_64;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_65;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_66;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_67;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_68;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_69;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_70;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_71;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_72;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_Diffuse;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_Face;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_Normal;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_PointSize;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_Specular;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_TextureCoordinate;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_UVLightmapGroups;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_VertexPosition;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_VertexPositionTransformed;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_XYZB1;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_XYZB2;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_XYZB3;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_XYZB4;
import static de.george.lrentnode.enums.G3Enums.eEVertexStreamArrayType.eEVertexStreamArrayType_XYZB5;
import static de.george.lrentnode.enums.G3Enums.eEVertexTypeStruct.eEVertexTypeStruct_GEFloat;
import static de.george.lrentnode.enums.G3Enums.eEVertexTypeStruct.eEVertexTypeStruct_GEU16;
import static de.george.lrentnode.enums.G3Enums.eEVertexTypeStruct.eEVertexTypeStruct_GEU32;
import static de.george.lrentnode.enums.G3Enums.eEVertexTypeStruct.eEVertexTypeStruct_bCVector2;
import static de.george.lrentnode.enums.G3Enums.eEVertexTypeStruct.eEVertexTypeStruct_bCVector3;
import static de.george.lrentnode.enums.G3Enums.eEVertexTypeStruct.eEVertexTypeStruct_bCVector4;

import java.util.ArrayList;
import java.util.List;

import com.google.common.collect.ImmutableMap;

import de.george.g3utils.io.G3FileReader;
import de.george.g3utils.io.G3FileWriter;
import de.george.g3utils.io.G3Serializable;
import de.george.g3utils.structure.bCBox;
import de.george.g3utils.structure.bCVector;
import de.george.g3utils.structure.bCVector2;
import de.george.g3utils.structure.bCVector4;

public class eCMeshElement implements G3Serializable {
	public static class eSFVF {
		public final int vertexStreamArrayType;
		public final int vertexTypeStruct;
		public final int fvf;

		private eSFVF(int vertexStreamArrayType, int vertexTypeStruct, int fvf) {
			this.vertexStreamArrayType = vertexStreamArrayType;
			this.vertexTypeStruct = vertexTypeStruct;
			this.fvf = fvf;
		}
	}

	private static final ImmutableMap<Integer, eSFVF> vertexStreamToStructMap = ImmutableMap.<Integer, eSFVF>builder()
			.put(eEVertexStreamArrayType_Face, new eSFVF(eEVertexStreamArrayType_Face, eEVertexTypeStruct_GEU32, 0x0))
			.put(eEVertexStreamArrayType_VertexPosition,
					new eSFVF(eEVertexStreamArrayType_VertexPosition, eEVertexTypeStruct_bCVector3, 0x2))
			.put(eEVertexStreamArrayType_VertexPositionTransformed,
					new eSFVF(eEVertexStreamArrayType_VertexPositionTransformed, eEVertexTypeStruct_bCVector4, 0x4))
			.put(eEVertexStreamArrayType_Normal, new eSFVF(eEVertexStreamArrayType_Normal, eEVertexTypeStruct_bCVector3, 0x10))
			.put(eEVertexStreamArrayType_Diffuse, new eSFVF(eEVertexStreamArrayType_Diffuse, eEVertexTypeStruct_GEU32, 0x40))
			.put(eEVertexStreamArrayType_Specular, new eSFVF(eEVertexStreamArrayType_Specular, eEVertexTypeStruct_GEU32, 0x80))
			.put(eEVertexStreamArrayType_PointSize, new eSFVF(eEVertexStreamArrayType_PointSize, eEVertexTypeStruct_GEFloat, 0x20))
			.put(eEVertexStreamArrayType_XYZB1, new eSFVF(eEVertexStreamArrayType_XYZB1, eEVertexTypeStruct_GEFloat, 0x6))
			.put(eEVertexStreamArrayType_XYZB2, new eSFVF(eEVertexStreamArrayType_XYZB2, eEVertexTypeStruct_GEFloat, 0x8))
			.put(eEVertexStreamArrayType_XYZB3, new eSFVF(eEVertexStreamArrayType_XYZB3, eEVertexTypeStruct_GEFloat, 0x0A))
			.put(eEVertexStreamArrayType_XYZB4, new eSFVF(eEVertexStreamArrayType_XYZB4, eEVertexTypeStruct_GEFloat, 0x0C))
			.put(eEVertexStreamArrayType_XYZB5, new eSFVF(eEVertexStreamArrayType_XYZB5, eEVertexTypeStruct_GEFloat, 0x0E))
			.put(eEVertexStreamArrayType_TextureCoordinate,
					new eSFVF(eEVertexStreamArrayType_TextureCoordinate, eEVertexTypeStruct_bCVector2, 0))
			.put(eEVertexStreamArrayType_13, new eSFVF(eEVertexStreamArrayType_13, eEVertexTypeStruct_bCVector3, 0x10000))
			.put(eEVertexStreamArrayType_14, new eSFVF(eEVertexStreamArrayType_14, eEVertexTypeStruct_bCVector4, 0x20000))
			.put(eEVertexStreamArrayType_15, new eSFVF(eEVertexStreamArrayType_15, eEVertexTypeStruct_bCVector2, 0))
			.put(eEVertexStreamArrayType_16, new eSFVF(eEVertexStreamArrayType_16, eEVertexTypeStruct_bCVector3, 0x40000))
			.put(eEVertexStreamArrayType_17, new eSFVF(eEVertexStreamArrayType_17, eEVertexTypeStruct_bCVector4, 0x80000))
			.put(eEVertexStreamArrayType_18, new eSFVF(eEVertexStreamArrayType_18, eEVertexTypeStruct_bCVector2, 0))
			.put(eEVertexStreamArrayType_19, new eSFVF(eEVertexStreamArrayType_19, eEVertexTypeStruct_bCVector3, 0x100000))
			.put(eEVertexStreamArrayType_20, new eSFVF(eEVertexStreamArrayType_20, eEVertexTypeStruct_bCVector4, 0x200000))
			.put(eEVertexStreamArrayType_21, new eSFVF(eEVertexStreamArrayType_21, eEVertexTypeStruct_bCVector2, 0))
			.put(eEVertexStreamArrayType_22, new eSFVF(eEVertexStreamArrayType_22, eEVertexTypeStruct_bCVector3, 0x400000))
			.put(eEVertexStreamArrayType_23, new eSFVF(eEVertexStreamArrayType_23, eEVertexTypeStruct_bCVector4, 0x800000))
			.put(eEVertexStreamArrayType_24, new eSFVF(eEVertexStreamArrayType_24, eEVertexTypeStruct_bCVector2, 0))
			.put(eEVertexStreamArrayType_25, new eSFVF(eEVertexStreamArrayType_25, eEVertexTypeStruct_bCVector3, 0x1000000))
			.put(eEVertexStreamArrayType_26, new eSFVF(eEVertexStreamArrayType_26, eEVertexTypeStruct_bCVector4, 0x2000000))
			.put(eEVertexStreamArrayType_27, new eSFVF(eEVertexStreamArrayType_27, eEVertexTypeStruct_bCVector2, 0))
			.put(eEVertexStreamArrayType_28, new eSFVF(eEVertexStreamArrayType_28, eEVertexTypeStruct_bCVector3, 0x4000000))
			.put(eEVertexStreamArrayType_29, new eSFVF(eEVertexStreamArrayType_29, eEVertexTypeStruct_bCVector4, 0x8000000))
			.put(eEVertexStreamArrayType_30, new eSFVF(eEVertexStreamArrayType_30, eEVertexTypeStruct_bCVector2, 0))
			.put(eEVertexStreamArrayType_31, new eSFVF(eEVertexStreamArrayType_31, eEVertexTypeStruct_bCVector3, 0x10000000))
			.put(eEVertexStreamArrayType_32, new eSFVF(eEVertexStreamArrayType_32, eEVertexTypeStruct_bCVector4, 0x20000000))
			.put(eEVertexStreamArrayType_33, new eSFVF(eEVertexStreamArrayType_33, eEVertexTypeStruct_bCVector2, 0))
			.put(eEVertexStreamArrayType_34, new eSFVF(eEVertexStreamArrayType_34, eEVertexTypeStruct_bCVector3, 0x40000000))
			.put(eEVertexStreamArrayType_35, new eSFVF(eEVertexStreamArrayType_35, eEVertexTypeStruct_bCVector4, 0x80000000))
			.put(eEVertexStreamArrayType_36, new eSFVF(eEVertexStreamArrayType_36, eEVertexTypeStruct_bCVector2, 0))
			.put(eEVertexStreamArrayType_37, new eSFVF(eEVertexStreamArrayType_37, eEVertexTypeStruct_bCVector3, 0))
			.put(eEVertexStreamArrayType_38, new eSFVF(eEVertexStreamArrayType_38, eEVertexTypeStruct_bCVector4, 0))
			.put(eEVertexStreamArrayType_39, new eSFVF(eEVertexStreamArrayType_39, eEVertexTypeStruct_bCVector2, 0))
			.put(eEVertexStreamArrayType_40, new eSFVF(eEVertexStreamArrayType_40, eEVertexTypeStruct_bCVector3, 0))
			.put(eEVertexStreamArrayType_41, new eSFVF(eEVertexStreamArrayType_41, eEVertexTypeStruct_bCVector4, 0))
			.put(eEVertexStreamArrayType_42, new eSFVF(eEVertexStreamArrayType_42, eEVertexTypeStruct_bCVector2, 0))
			.put(eEVertexStreamArrayType_43, new eSFVF(eEVertexStreamArrayType_43, eEVertexTypeStruct_bCVector3, 0))
			.put(eEVertexStreamArrayType_44, new eSFVF(eEVertexStreamArrayType_44, eEVertexTypeStruct_bCVector4, 0))
			.put(eEVertexStreamArrayType_45, new eSFVF(eEVertexStreamArrayType_45, eEVertexTypeStruct_bCVector2, 0))
			.put(eEVertexStreamArrayType_46, new eSFVF(eEVertexStreamArrayType_46, eEVertexTypeStruct_bCVector3, 0))
			.put(eEVertexStreamArrayType_47, new eSFVF(eEVertexStreamArrayType_47, eEVertexTypeStruct_bCVector4, 0))
			.put(eEVertexStreamArrayType_48, new eSFVF(eEVertexStreamArrayType_48, eEVertexTypeStruct_bCVector2, 0))
			.put(eEVertexStreamArrayType_49, new eSFVF(eEVertexStreamArrayType_49, eEVertexTypeStruct_bCVector3, 0))
			.put(eEVertexStreamArrayType_50, new eSFVF(eEVertexStreamArrayType_50, eEVertexTypeStruct_bCVector4, 0))
			.put(eEVertexStreamArrayType_51, new eSFVF(eEVertexStreamArrayType_51, eEVertexTypeStruct_bCVector2, 0))
			.put(eEVertexStreamArrayType_52, new eSFVF(eEVertexStreamArrayType_52, eEVertexTypeStruct_bCVector3, 0))
			.put(eEVertexStreamArrayType_53, new eSFVF(eEVertexStreamArrayType_53, eEVertexTypeStruct_bCVector4, 0))
			.put(eEVertexStreamArrayType_54, new eSFVF(eEVertexStreamArrayType_54, eEVertexTypeStruct_bCVector2, 0))
			.put(eEVertexStreamArrayType_55, new eSFVF(eEVertexStreamArrayType_55, eEVertexTypeStruct_bCVector3, 0))
			.put(eEVertexStreamArrayType_56, new eSFVF(eEVertexStreamArrayType_56, eEVertexTypeStruct_bCVector4, 0))
			.put(eEVertexStreamArrayType_57, new eSFVF(eEVertexStreamArrayType_57, eEVertexTypeStruct_bCVector2, 0))
			.put(eEVertexStreamArrayType_58, new eSFVF(eEVertexStreamArrayType_58, eEVertexTypeStruct_bCVector3, 0))
			.put(eEVertexStreamArrayType_59, new eSFVF(eEVertexStreamArrayType_59, eEVertexTypeStruct_bCVector4, 0))
			.put(eEVertexStreamArrayType_60, new eSFVF(eEVertexStreamArrayType_60, eEVertexTypeStruct_bCVector4, 0))
			.put(eEVertexStreamArrayType_61, new eSFVF(eEVertexStreamArrayType_61, eEVertexTypeStruct_bCVector4, 0))
			.put(eEVertexStreamArrayType_62, new eSFVF(eEVertexStreamArrayType_62, eEVertexTypeStruct_bCVector4, 0))
			.put(eEVertexStreamArrayType_63, new eSFVF(eEVertexStreamArrayType_63, eEVertexTypeStruct_bCVector4, 0))
			.put(eEVertexStreamArrayType_64, new eSFVF(eEVertexStreamArrayType_64, eEVertexTypeStruct_bCVector3, 0))
			.put(eEVertexStreamArrayType_65, new eSFVF(eEVertexStreamArrayType_65, eEVertexTypeStruct_bCVector3, 0))
			.put(eEVertexStreamArrayType_66, new eSFVF(eEVertexStreamArrayType_66, eEVertexTypeStruct_bCVector3, 0))
			.put(eEVertexStreamArrayType_67, new eSFVF(eEVertexStreamArrayType_67, eEVertexTypeStruct_bCVector3, 0))
			.put(eEVertexStreamArrayType_68, new eSFVF(eEVertexStreamArrayType_68, eEVertexTypeStruct_bCVector2, 0))
			.put(eEVertexStreamArrayType_69, new eSFVF(eEVertexStreamArrayType_69, eEVertexTypeStruct_bCVector2, 0))
			.put(eEVertexStreamArrayType_70, new eSFVF(eEVertexStreamArrayType_70, eEVertexTypeStruct_bCVector2, 0))
			.put(eEVertexStreamArrayType_71, new eSFVF(eEVertexStreamArrayType_71, eEVertexTypeStruct_bCVector2, 0))
			.put(eEVertexStreamArrayType_72, new eSFVF(eEVertexStreamArrayType_72, eEVertexTypeStruct_bCVector3, 0))
			.put(eEVertexStreamArrayType_UVLightmapGroups,
					new eSFVF(eEVertexStreamArrayType_UVLightmapGroups, eEVertexTypeStruct_bCVector2, 0))
			.build();

	public abstract static class eCVertexStructArrayBase<T> implements G3Serializable {
		public int vertexStreamArrayType;
		public List<T> elements;

		public eCVertexStructArrayBase(int vertexStreamArrayType) {
			this.vertexStreamArrayType = vertexStreamArrayType;
			this.elements = new ArrayList<>();
		}

		@Override
		public void read(G3FileReader reader) {
			// Skip one word, always 0100
			reader.skip(2);

			elements = reader.readPrefixedList(this::readElement);
		}

		protected abstract T readElement(G3FileReader reader);

		@Override
		public void write(G3FileWriter writer) {
			writer.writeUnsignedShort(1);

			writer.writePrefixedList(elements, this::writeElement);
		}

		protected abstract void writeElement(G3FileWriter writer, T element);
	}

	public static class eCVertexStructArray_GEFloat extends eCVertexStructArrayBase<Float> {
		public eCVertexStructArray_GEFloat(int vertexStreamArrayType) {
			super(vertexStreamArrayType);
		}

		@Override
		protected Float readElement(G3FileReader reader) {
			return reader.readFloat();
		}

		@Override
		protected void writeElement(G3FileWriter writer, Float element) {
			writer.writeFloat(element);
		}
	}

	public static class eCVertexStructArray_GEU16 extends eCVertexStructArrayBase<Integer> {
		public eCVertexStructArray_GEU16(int vertexStreamArrayType) {
			super(vertexStreamArrayType);
		}

		@Override
		protected Integer readElement(G3FileReader reader) {
			return reader.readInt();
		}

		@Override
		protected void writeElement(G3FileWriter writer, Integer element) {
			writer.writeInt(element);
		}
	}

	public static class eCVertexStructArray_GEU32 extends eCVertexStructArrayBase<Integer> {
		public eCVertexStructArray_GEU32(int vertexStreamArrayType) {
			super(vertexStreamArrayType);
		}

		@Override
		protected Integer readElement(G3FileReader reader) {
			return reader.readInt();
		}

		@Override
		protected void writeElement(G3FileWriter writer, Integer element) {
			writer.writeInt(element);
		}
	}

	public static class eCVertexStructArray_bCVector2 extends eCVertexStructArrayBase<bCVector2> {
		public eCVertexStructArray_bCVector2(int vertexStreamArrayType) {
			super(vertexStreamArrayType);
		}

		@Override
		protected bCVector2 readElement(G3FileReader reader) {
			return reader.read(bCVector2.class);
		}

		@Override
		protected void writeElement(G3FileWriter writer, bCVector2 element) {
			writer.write(element);
		}
	}

	public static class eCVertexStructArray_bCVector3 extends eCVertexStructArrayBase<bCVector> {
		public eCVertexStructArray_bCVector3(int vertexStreamArrayType) {
			super(vertexStreamArrayType);
		}

		@Override
		protected bCVector readElement(G3FileReader reader) {
			return reader.read(bCVector.class);
		}

		@Override
		protected void writeElement(G3FileWriter writer, bCVector element) {
			writer.write(element);
		}
	}

	public static class eCVertexStructArray_bCVector4 extends eCVertexStructArrayBase<bCVector4> {
		public eCVertexStructArray_bCVector4(int vertexStreamArrayType) {
			super(vertexStreamArrayType);
		}

		@Override
		protected bCVector4 readElement(G3FileReader reader) {
			return reader.read(bCVector4.class);
		}

		@Override
		protected void writeElement(G3FileWriter writer, bCVector4 element) {
			writer.write(element);
		}
	}

	@SuppressWarnings("unchecked")
	public static <T, A extends eCVertexStructArrayBase<T>> A createVertexStructArray(int vertexStreamArrayType) {
		return (A) switch (vertexStreamToStructMap.get(vertexStreamArrayType).vertexTypeStruct) {
			case eEVertexTypeStruct_bCVector2 -> new eCVertexStructArray_bCVector2(vertexStreamArrayType);
			case eEVertexTypeStruct_bCVector3 -> new eCVertexStructArray_bCVector3(vertexStreamArrayType);
			case eEVertexTypeStruct_bCVector4 -> new eCVertexStructArray_bCVector4(vertexStreamArrayType);
			case eEVertexTypeStruct_GEU16 -> new eCVertexStructArray_GEU16(vertexStreamArrayType);
			case eEVertexTypeStruct_GEU32 -> new eCVertexStructArray_GEU32(vertexStreamArrayType);
			case eEVertexTypeStruct_GEFloat -> new eCVertexStructArray_GEFloat(vertexStreamArrayType);
			default -> throw new IllegalArgumentException();
		};
	}

	private int version;
	private int fvf;
	private bCBox boundingBox;
	private int size;
	private String materialName;
	private List<eCVertexStructArrayBase<?>> streamArrays;

	@Override
	public void write(G3FileWriter writer) {
		throw new UnsupportedOperationException();
	}

	@Override
	public void read(G3FileReader reader) {
		version = reader.readUnsignedShort();
		fvf = reader.readInt();
		boundingBox = reader.readBox();
		size = reader.readInt();
		materialName = reader.readEntry();

		int streamArrayCount = reader.readInt();
		streamArrays = new ArrayList<>(streamArrayCount);
		while (streamArrayCount-- > 0) {
			int streamArrayType = reader.readInt();
			eCVertexStructArrayBase<?> vertexArray = createVertexStructArray(streamArrayType);
			vertexArray.read(reader);
			streamArrays.add(vertexArray);
		}

		if (version >= 3) {
			// Skip eSLightmapPerVertexGroup
			// @foff
			/*
			 * struct eSLightmapPerVertexGroup {
			 * 	bTValArray<unsigned long>;
			 *	bTValArray<unsigned long>;
			 * }
			 */
			// @fon
			reader.skip(1); // true
			reader.skip(reader.readInt() * 4);
			reader.skip(1); // true
			reader.skip(reader.readInt() * 4);
		}

		if (version >= 2) {
			// Skip LightmapUVGroups
			reader.skip(1); // true
			int groupCount = reader.readInt();
			while (groupCount-- > 0) {
				// @foff
				/*
				 * struct eSLightmapUVGroup {
				 * 	bTValArray<unsigned long>;
				 * 	bTValArray<unsigned long>;
				 *  bCVector;
				 *  bCMatrix;
				 *  bCVector2;
				 * }
				 */
				// @fon
				reader.skip(1); // true
				reader.skip(reader.readInt() * 4);
				reader.skip(1); // true
				reader.skip(reader.readInt() * 4);
				reader.skip(12 + 64 + 8);
			}
		}

		// if(version < 5) -> clear m_arrLightmapUVGroups and delete stream array 0x48

		if (version >= 4) {
			// @foff
			/*
			 * struct eCSpatialHierarchy {
			 * 	struct eSHierarchyElement {
			 *   bCSphere;
			 *   unsigned long;
			 *   unsigned long;
			 *  }
			 *
			 *  bTValArray<unsigned long>;
			 * }
			 */
			// @fon
			reader.skip(reader.readInt() * 24);
			reader.skip(1);
			reader.skip(reader.readInt() * 4);
		}
	}

	public int getVersion() {
		return version;
	}

	public int getFvf() {
		return fvf;
	}

	public bCBox getBoundingBox() {
		return boundingBox;
	}

	public int getSize() {
		return size;
	}

	public String getMaterialName() {
		return materialName;
	}

	@SuppressWarnings("unchecked")
	public boolean hasStreamArray(int type) {
		return streamArrays.stream().anyMatch(a -> a.vertexStreamArrayType == type);
	}

	@SuppressWarnings("unchecked")
	public <B> List<B> getStreamArrayByType(int type) {
		return (List<B>) streamArrays.stream().filter(a -> a.vertexStreamArrayType == type).findFirst().get().elements;
	}

	public List<eCVertexStructArrayBase<?>> getStreamArrays() {
		return streamArrays;
	}
}
